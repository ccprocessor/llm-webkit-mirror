# 流水线Markdown格式数据输出标准

## 原则

1. 使用markdown的最小子集满足业务需求
2. 最大可能兼容开源markdown库，方便网页、各类现有编辑器渲染
3. 每个规范点有且仅有一种正确实现
4. 着重定义markdown中格式特定的符号与正文符号的转换关系

## 适用场景

1. 从HTML、PDF等提取的数据，给到训练模型时需要以md格式。

> ⚠️有从txt和md格式得到的原始数据，不适用于本规则。

## 定义

### 代码

代码块使用三个反引号包裹，后面跟上语言类型，如下所示：

```python
print("Hello, World!")
```

如果是行内的代码块，则使用一个反引号包裹，包含语言字段，如：

Wrap elements in `<Fragment>` to group them together in situations where you need a single element.

**细节**

- 代码块中的内容会保持原样输出，包括空格、换行等
- 代码块前后有且仅有一个空行
- 三个反引号必须顶格，前面不能有空格，其后跟的语言之间不能有空格

### 公式

公式分为行内公式和块级公式，行内公式使用`$`包裹，块级公式使用`$$`包裹，如下所示：

______________________________________________________________________

爱因斯坦的质能方程是$E=mc^2$，其中$m$是物体的质量，$c$是光速。
$$
E=mc^2
$$
其中$m$是物体的质量，$c$是光速。

**细节**

- 行间公式前后有且仅有一个空行，双$$符号顶格，前后不能有空格，并且独占一行
- 中、日、韩语言的行内公式$前后不需要空格
- 英文行内公式$前后需要空格。例如:`A formula is $a^2 + b^2 = c^2$`
- 其他语种待定
- 行间公式的`$$`前禁止有额外的`空格`

### 图片

图片使用`![]()`包裹，括号内为图片链接，如下所示：
![图片alt](https://www.baidu.com/img/bd_logo1.png)

**细节**

- 图片前后有且仅有一个空行, `!`顶格，与`[`号之间不能有空格
- 图片链接为绝对路径,或者是url的某种变形如sha256(abs_path)
- 图片链接后可以跟一个空格和图片标题，如`![图片](https://www.baidu.com/img/bd_logo1.png "百度logo")`
- 方括号里存放图片的alt信息，用于图片无法显示时的替代文本
- 连接后的字符串用于存放图片的title属性，如果title没有则存放描述信息。都没有则什么都不写。

### 音频

暂时忽略

### 视频

暂时忽略

### 表格

表格分为简单表格和复杂表格

- 简单表格：没有跨行跨列的表格
- 复杂表格：有跨行跨列的表格

#### 简单表格

简单表格使用`|`分割，如下所示：

______________________________________________________________________

| 1   | 2   | 3   |
| --- | --- | --- |
| 4   | 5   | 6   |

______________________________________________________________________

**细节**

- 表格前后有且仅有一个空行,首个`|`顶格
- 表头和表格内容之间使用`---`分割，`-`个数不可多也不能少，3个
- 每行第一个`|`紧靠左边，最后一个`|`紧靠右边，不能有空格

#### 复杂表格

由于markdown的表格不支持跨行跨列，所以复杂表格需要使用html标签`<table>`来实现，如下所示：

______________________________________________________________________

<table>
  <tr>
    <th>Header 1</th>
    <th>Header 2</th>
  </tr>
  <tr>
    <td>row 1, cell 1</td>
    <td>row 1, cell 2</td>
  </tr>
  <tr>
    <td>row 2, cell 1</td>
    <td>row 2, cell 2</td>
  </tr>
</table>

______________________________________________________________________

**细节**

- 表格前后有且仅有一个空行
- 表格的html代码要进行格式化，不能写在一行
- 除了`rowspan`和`colspan`，其他属性全部丢弃
- `<table>`和`</table>`顶格，独占一行

### 列表

列表分为有序列表和无序列表

- 有序列表：使用数字加`.`表示
- 无序列表：使用`-`表示

#### 有序列表

有序列表使用数字加`.`表示，如下所示：

______________________________________________________________________

1. 第一项
   1. 子项1
   2. 子项2
2. 第二项
3. 第三项
4. 第四项

______________________________________________________________________

**细节**

- 有序列表前后有且仅有一个空行，最顶层数字序号顶格
- 支持多级嵌套，子项前面有两个空格
- `数字.`之后有且只有一个空格.最顶级数字前不能有`空格`。

#### 无序列表

无序列表使用`-`表示，如下所示：

______________________________________________________________________

- 第一项
  - 子项1
  - 子项2
  - 子项3
- 第二项
- 第三项
- 第四项

______________________________________________________________________

**细节**

- 无序列表前后有且仅有一个空行，最顶层`-`顶格
- 支持多级嵌套，子项前面有两个空格
- `-`之后有且只有一个空格
- 最顶级`-`前不能有`空格`。

### 标题

标题使用`#`表示，`#`的数量表示标题的级别，如下所示：

______________________________________________________________________

# 一级标题

## 二级标题

### 三级标题

#### 四级标题

______________________________________________________________________

**细节**

- 标题前后有且仅有一个空行，`#`顶格
- `#`之后有且只有一个空格
- `#`之前不能有空格

### 文本段落

段落开头不需要缩进，段落之间需要1个空行，如下所示：

______________________________________________________________________

这是第一个段落，这里换行了
这是第一段的第二句话。

这是第二段，这里换行了
这是第二段的第二句话。

## 这是第三段，这里换行了， 这是第三段的第二句话。

**细节**

- 段落之间有且仅有一个空行，空行strip之后长度为0
- 段落开头不需要缩进，也不能有空格
- 段落结尾不需要空格
- 同一个段落内不允许有`\n`和`\r`换行符

### 换行

- 全文内不允许有连续3个及以上换行符
- 段落、图片、代码等块结尾的换行之后不允许有任何其他符号出现

### HTML中的上下标

特指`<sub>`和`<sup>`标签.在markdown里原样保留。

### Markdown保留符号

markdown保留符号是在markdown中有特殊意义的符号，如`#`、`*`、`_`等，这些符号在markdown中有特殊意义，
如果正文中使用了这些字符，需要使用转义符`\`。

> 由于本标准只是一个子集，所以不支持所有的markdown保留符号，只支持在`特定区域`内对`特定符号`的转义：

- `#`：行开头顶格连续的`#`，代表标题。
- \`\`\` ：行开头连续的3个。代表代码块开头结尾。
- `$`：行内公式
- `$$`：块级公式

除了以上几个`符号`, 如果上述符号出现在`文本段落`（行内公式除外），则都需被转义（图片，列表、代码、行间公式、表格中的文字无需转义）。

### 不支持元素

- 加粗
- 下划线
- 斜体
- 删除线
- 引用块
- 等款字体
- 链接
- 分割线

> 以上本标准都不支持，全都当成普通文本处理。

### 标准参考链接

- [大模型md格式标准](https://aicarrier.feishu.cn/wiki/VEDgwgXHmiY1PpkUQxEckLgIn7d)
- [Markdown](https://www.markdownguide.org/basic-syntax/)
