
<!doctype html>
<html data-n-head-ssr lang="zh" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22zh%22%7D%7D">
  <head >
    <title>vue3中effect与computed的亲密关系船到桥头自然直，柳岸花明又一村。苦心人天不负，偶然间我看到了effec - 掘金</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover"><meta data-n-head="ssr" name="apple-itunes-app" content="app-id=987739104"><meta data-n-head="ssr" name="theme-color" content="#ffffff"><meta data-n-head="ssr" name="msapplication-TileColor" content="#da532c"><meta data-n-head="ssr" name="msvalidate.01" content="BADCF2429624CB0432BE8924E5343343"><meta data-n-head="ssr" name="google-site-verification" content="NmjYe_Q4CrbogdzvVlZMhhCQFp4CNdc6H5wJuNZLtNI"><meta data-n-head="ssr" vmid="description" name="description" content="船到桥头自然直，柳岸花明又一村。苦心人天不负，偶然间我看到了effect测试代码用例！ 然而，这个依赖收集器 deps 不能放在 target 本身上，这样会使数据看起来不是很简洁，还会存在多余无用的数据，所以我们需要一个 map 集合来储存 target 跟 deps 的关系…"><meta data-n-head="ssr" vmid="keywords" name="keywords" content="Vue.js中文技术社区,前端开发社区,前端技术交流,前端框架教程,JavaScript 学习资源,CSS 技巧与最佳实践,HTML5 最新动态,前端工程师职业发展,开源前端项目,前端技术趋势"><link data-n-head="ssr" rel="preconnect" href="//unpkg.byted-static.com/" crossorigin="anonymous"><link data-n-head="ssr" rel="preconnect" href="//lf3-cdn-tos.bytescm.com" crossorigin="anonymous"><link data-n-head="ssr" rel="preconnect" href="//mcs.snssdk.com" crossorigin="anonymous"><link data-n-head="ssr" rel="preconnect" href="//i.snssdk.com" crossorigin="anonymous"><link data-n-head="ssr" rel="dns-prefetch" href="//lf3-short.ibytedapm.com"><link data-n-head="ssr" rel="dns-prefetch" href="//lf3-cdn-tos.bytescm.com"><link data-n-head="ssr" rel="dns-prefetch" href="//api.juejin.cn"><link data-n-head="ssr" rel="dns-prefetch" href="//lf-cdn-tos.bytescm.com"><link data-n-head="ssr" rel="dns-prefetch" href="//unpkg.byted-static.com"><link data-n-head="ssr" rel="dns-prefetch" href="//p1-juejin.byteimg.com"><link data-n-head="ssr" rel="dns-prefetch" href="//p3-juejin.byteimg.com"><link data-n-head="ssr" rel="dns-prefetch" href="//p6-juejin.byteimg.com"><link data-n-head="ssr" rel="dns-prefetch" href="//p9-juejin.byteimg.com"><link data-n-head="ssr" rel="dns-prefetch" href="//p1-jj.byteimg.com"><link data-n-head="ssr" rel="dns-prefetch" href="//p2-jj.byteimg.com"><link data-n-head="ssr" rel="dns-prefetch" href="//p6-jj.byteimg.com"><link data-n-head="ssr" rel="dns-prefetch" href="//p9-jj.byteimg.com"><link data-n-head="ssr" rel="dns-prefetch" href="//mcs.snssdk.com"><link data-n-head="ssr" rel="dns-prefetch" href="//i.snssdk.com"><link data-n-head="ssr" rel="apple-touch-icon" sizes="180x180" href="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/favicons/apple-touch-icon.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="32x32" href="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/favicons/favicon-32x32.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="16x16" href="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/favicons/favicon-16x16.png"><link data-n-head="ssr" rel="mask-icon" href="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/favicons/safari-pinned-tab.svg" color="#1E80FF"><link data-n-head="ssr" rel="manifest" href="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/favicons/site.webmanifest"><link data-n-head="ssr" rel="search" title="掘金" href="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/search.xml" type="application/opensearchdescription+xml"><link data-n-head="ssr" rel="stylesheet" href="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/bytedesign.min.css"><link data-n-head="ssr" rel="canonical" href="https://juejin.cn/post/6844903960826888206"><script data-n-head="ssr" type="text/javascript" data-sdk-glue-default="load" src="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/rc-client-security-web-glue/1.0.0.19/sdk-glue.js"></script><script data-n-head="ssr" type="text/javascript" data-sdk-glue-default="init">
        (function (){
          var options = {
            bdms: {
              aid: 2608,
              paths: [
                '/growth_api/v1/publish_benefit_history',
                '/growth_api/v1/check_in',
                '/growth_api/v1/lottery/draw',
                '/growth_api/v1/lottery/ten_draw',
                '/web_shorten',
                '/user_api/v1/user/get',
                '/interact_api/v1/digg/save',
                '/interact_api/v1/digg/query_page',
                '/interact_api/v1/comment/list',
                '/interact_api/v1/comment/hots',
                '/content_api/v1/article/detail',
                '/user_api/v1/follow/followees',
                '/user_api/v1/follow/followers',
                '/interact_api/v1/follow/tag_list',
                '/recommend_api/v1/article/recommend_cate_feed',
                '/interact_api/v1/comment/publish',
                '/interact_api/v1/reply/publish',
                '/growth_api/v1/get_benefit_page',
                '/growth_api/v1/get_cur_point',
                '/growth_api/v1/ten_draw',
                '/growth_api/v1/draw',
                '/growth_api/v1/lottery_config/get',
              ]
            },
            verifyCenter: {
              interceptPathList: [
                '/user_api/v1/user/get',
                '/interact_api/v1/digg/save',
                '/interact_api/v1/digg/query_page',
                '/interact_api/v1/comment/list',
                '/interact_api/v1/comment/hots',
                '/content_api/v1/article/detail',
                '/user_api/v1/follow/followees',
                '/user_api/v1/follow/followers',
                '/interact_api/v1/follow/tag_list',
                '/recommend_api/v1/article/recommend_cate_feed',
              ],
              commonOptions: {
                aid: 2608,
                repoId: 56081
              },
              captchaOptions: {
                showMode: 'mask',
              },
            }
          }
        var sdkInfo = {
          bdms: {
            init: function (options) {
              window.bdms.init(options)
            },
            isLoaded: function () {
              return !!window.bdms
            },
            srcList: [
              'https://lf-headquarters-speed.yhgfb-cn-static.com/obj/rc-client-security/web/stable/1.0.0.33/bdms.js',
              'https://lf-c-flwb.bytetos.com/obj/rc-client-security/web/stable/1.0.0.33/bdms.js',
            ],
          },
          verifyCenter: {
            init: function (options) {
              window.TTGCaptcha.init(options);
            },
            isLoaded: function () {
              return !!window.TTGCaptcha;
            },
            srcList: [
              'https://lf-cdn-tos.bytescm.com/obj/rc-verifycenter/sec_sdk_build/4.0.10/captcha/index.js',
              'https://lf-rc1.yhgfb-cn-static.com/obj/rc-verifycenter/sec_sdk_build/4.0.10/captcha/index.js',
            ],
          }
        }
        window._SdkGlueInit(options, sdkInfo)
        })();
        </script><script data-n-head="ssr" vmid="slardar" type="text/javascript" crossorigin="anonymous">;(function (w, d, u, b, n, pc, ga, ae, po, s, p, e, t, pp) {pc = 'precollect';ga = 'getAttribute';ae = 'addEventListener';po = 'PerformanceObserver';s = function (m) {p = [].slice.call(arguments);p.push(Date.now(), location.href);(m == pc ? s.p.a : s.q).push(p)};s.q = [];s.p = { a: [] };w[n] = s;e = document.createElement('script');e.src = u + '?bid=' + b + '&globalName=' + n;e.crossOrigin = u.indexOf('sdk-web') > 0 ? 'anonymous' : 'use-credentials';d.getElementsByTagName('head')[0].appendChild(e);if (ae in w) {s.pcErr = function (e) {e = e || w.event;t = e.target || e.srcElement;if (t instanceof Element || t instanceof HTMLElement) {if (t[ga]('integrity')) {w[n](pc, 'sri', t[ga]('href') || t[ga]('src'))} else {w[n](pc, 'st', { tagName: t.tagName, url: t[ga]('href') || t[ga]('src') })}} else {w[n](pc, 'err', e.error || e.message)}};s.pcRej = function (e) {e = e || w.event;w[n](pc, 'err', e.reason || (e.detail && e.detail.reason))};w[ae]('error', s.pcErr, true);w[ae]('unhandledrejection', s.pcRej, true);};if('PerformanceLongTaskTiming' in w) {pp = s.pp = { entries: [] };pp.observer = new PerformanceObserver(function (l) {pp.entries = pp.entries.concat(l.getEntries())});pp.observer.observe({ entryTypes: ['longtask', 'largest-contentful-paint','layout-shift'] })}})(window,document,'https://lf3-short.ibytedapm.com/slardar/fe/sdk-web/browser.cn.js','2608','SlardarWeb')</script><script data-n-head="ssr" type="text/javascript" src="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/slardar-plugin/imageReport.js"></script><script data-n-head="ssr" type="text/javascript" src="https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/static/cdn-retry/bundle-dcf007.js" id="cdn-retry" defer></script><script data-n-head="ssr" type="application/ld+json">[{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://juejin.cn/post/6844903960826888206"},"headline":"vue3中effect与computed的亲密关系","description":"船到桥头自然直，柳岸花明又一村。苦心人天不负，偶然间我看到了effect测试代码用例！ 然而，这个依赖收集器 deps 不能放在 target 本身上，这样会使数据看起来不是很简洁，还会存在多余无用的数据，所以我们需要一个 map 集合来储存 target 跟 deps 的关系…","image":[],"author":{"@type":"Organization","name":"全栈技匠"},"publisher":{"@type":"Organization","name":"掘金","logo":{"@type":"ImageObject","url":"//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/e08da34488b114bd4c665ba2fa520a31.svg"}},"datePublished":"2019-10-10T15:39:26+00:00","dateModified":"2020-08-27T11:25:11+00:00"},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","name":"稀土掘金","position":1,"item":"https://juejin.cn"},{"@type":"ListItem","name":"前端","position":2,"item":"https://juejin.cn/frontend"},{"@type":"ListItem","name":"文章","position":3}]}]</script><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/b53b63f.js" as="script"><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/43d21bf.js" as="script"><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/1da5cc6.js" as="script"><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/app.36dedc7.css" as="style"><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/3e2b235.js" as="script"><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/layouts/default.291588e.css" as="style"><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/3fe243d.js" as="script"><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/57b1c75.js" as="script"><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/12.e7f582d.css" as="style"><link rel="preload" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/3a01791.js" as="script"><link rel="stylesheet" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/app.36dedc7.css"><link rel="stylesheet" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/layouts/default.291588e.css"><link rel="stylesheet" href="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/12.e7f582d.css">
  </head>
  <body >
    <script data-n-head="ssr" type="text/javascript" data-pbody="true">(function () {
    const pages = [
        /^\/$/,
        /^\/following$/,
        /^\/recommended$/,
        '^/pins.*',
        '^/pin.*',
        /^\/course(?!\/payment\/)/,
        /^\/post\/.*/,
        '^/hot.*',
        /^\/book\/\d+/,
        /^\/video\/\d+/,
        /^\/user\/settings.*/,
        /^\/spost\/\d+/,
        /^\/notification(?!\/im)/,
        '^/backend',
        '^/frontend',
        '^/android',
        '^/ios',
        '^/ai',
        '^/freebie',
        '^/career',
        '^/article',
        '^/player',
    ];
    function isInJuejinApp() {
        const userAgent = typeof navigator !== 'undefined' ? navigator.userAgent : '';
        return /juejin/i.test(userAgent);
    }
    if (typeof window !== 'undefined' && !isInJuejinApp()) {
        try {
            const path = window.location.pathname;
            const isAvailable = pages.some((page) => {
                const reg = new RegExp(page);
                return reg.test(path);
            });
            if (isAvailable) {
                const localValue = localStorage.getItem('juejin_2608_theme') || '{}';
                let { theme = 'light', isFollowSystem = false } = JSON.parse(localValue);
                if (isFollowSystem) {
                    const themeMedia = window.matchMedia('(prefers-color-scheme: light)');
                    theme = themeMedia.matches ? 'light' : 'dark';
                    localStorage.setItem('juejin_2608_theme', JSON.stringify({ theme, isFollowSystem }));
                }
                document.body.setAttribute('data-theme', theme);
            }
            else {
                document.body.setAttribute('data-theme', 'light');
            }
        }
        catch (e) {
            console.error('浏览器不支持localStorage');
        }
    }
})()</script><div data-server-rendered="true" id="__nuxt"><div id="__layout"><div id="juejin"><div class="view-container" data-v-cd15ceae data-v-7cdd11fb><div class="main-header-box" data-v-cd15ceae><header data-fetch-key="data-v-732a5c08:0" class="main-header main-header unauthorized visible" data-v-732a5c08 data-v-cd15ceae><div class="container" data-v-732a5c08><a href="/" class="logo" data-v-732a5c08><img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/e08da34488b114bd4c665ba2fa520a31.svg" alt="稀土掘金" class="logo-img" data-v-732a5c08> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/6c61ae65d1c41ae8221a670fa32d05aa.svg" alt="稀土掘金" class="mobile" data-v-732a5c08></a> <!----> <nav role="navigation" class="main-nav" data-v-732a5c08><ul class="nav-list" data-v-732a5c08><!----> <li class="main-nav-list" data-v-732a5c08><div class="phone-show-menu" data-v-732a5c08><span data-v-732a5c08>首页</span> <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="unfold16-icon" data-v-732a5c08 data-v-732a5c08><path d="M2.45025 4.82431C2.17422 4.49957 2.40501 4.00049 2.83122 4.00049H9.16878C9.59498 4.00049 9.82578 4.49957 9.54975 4.82431L6.38097 8.55229C6.1813 8.78719 5.8187 8.78719 5.61903 8.55229L2.45025 4.82431Z" data-v-732a5c08 data-v-732a5c08></path></svg></div> <ul class="phone-hide" data-v-732a5c08><li class="nav-item link-item" data-v-732a5c08><a href="/" data-v-732a5c08>首页</a></li> <li class="nav-item link-item bots" data-v-732a5c08><a href="/bots" data-v-732a5c08>
                BOT
                <span class="text" data-v-732a5c08><!----></span></a></li> <li class="nav-item link-item activities" data-v-732a5c08><a href="/pins" data-v-732a5c08>
                沸点
                <span class="text" data-v-732a5c08><!----></span></a></li> <li class="nav-item link-item book" data-v-732a5c08><a href="/course" data-v-732a5c08>
                课程
                <!----></a></li> <li class="nav-item link-item" data-v-732a5c08><a href="/live" data-v-732a5c08>
                直播
              </a></li> <li class="nav-item link-item" data-v-732a5c08><a href="/events/all" data-v-732a5c08>活动</a></li> <li class="nav-item link-item" data-v-732a5c08><a href="/problemset" data-v-732a5c08>AI刷题</a> <span class="new-font" data-v-732a5c08>NEW</span></li> <nav class="nav-item link-item" data-v-732a5c08><a href="https://detail.youzan.com/show/goods/newest?kdt_id=104340304" target="_blank" rel="nofollow noopener noreferrer" class="jj-link nav-item link-item no-border" data-v-65b50b51 data-v-732a5c08><span data-v-65b50b51 data-v-732a5c08>商城</span></a> <!----></nav> <nav class="nav-item link-item download-icon" data-v-732a5c08><a href="/app?utm_source=jj_nav" target="_blank" class="download-app no-border" data-v-732a5c08>
                APP
              </a></nav> <nav class="nav-item link-item extension-icon" data-v-732a5c08><a href="https://juejin.cn/extension?utm_source=jj_nav" target="_blank" rel="nofollow noopener noreferrer" class="jj-link broswer-extension no-border" data-v-65b50b51 data-v-732a5c08><span data-v-65b50b51 data-v-732a5c08>插件</span></a></nav> <!----></ul></li> <ul class="right-side-nav" data-v-732a5c08><li class="search-add" data-v-732a5c08><ul class="search-add-ul" data-v-732a5c08><li class="nav-item search" data-v-732a5c08><form role="search" class="search-form" data-v-732a5c08><input type="search" maxlength="64" placeholder="" value="" class="search-input" data-v-732a5c08> <div class="seach-icon-container" data-v-732a5c08><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="search-icon" data-v-732a5c08 data-v-732a5c08><path d="M12.4008 12.4008C14.744 10.0577 14.744 6.25871 12.4008 3.91556C10.0577 1.57242 6.25871 1.57242 3.91556 3.91556C1.57242 6.25871 1.57242 10.0577 3.91556 12.4008C6.25871 14.744 10.0577 14.744 12.4008 12.4008ZM12.4008 12.4008L15.5828 15.5828" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-732a5c08 data-v-732a5c08></path></svg></div> <!----> <div class="typehead" style="display:none;" data-v-732a5c08><!----> <div class="title" data-v-732a5c08><span data-v-732a5c08>搜索历史</span> <span class="clear" data-v-732a5c08>
                        清空
                      </span></div> <div class="list" data-v-732a5c08></div></div></form></li> <li class="nav-item add creator-item" data-v-732a5c08><div class="add-group" data-v-17cc1c49 data-v-732a5c08><!----> <button class="add-btn" data-v-17cc1c49>
    创作者中心
  </button> <div class="more" data-v-17cc1c49><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="unfold12-icon" data-v-17cc1c49 data-v-17cc1c49><path d="M2.45025 4.82383C2.17422 4.49908 2.40501 4 2.83122 4H9.16878C9.59499 4 9.82578 4.49908 9.54975 4.82382L6.38097 8.5518C6.1813 8.7867 5.8187 8.7867 5.61903 8.5518L2.45025 4.82383Z" fill="white" data-v-17cc1c49 data-v-17cc1c49></path></svg> <div class="more-mask" data-v-17cc1c49></div> <div class="more-list" data-v-17cc1c49><ul class="menu" data-v-17cc1c49><li class="item" data-v-17cc1c49><div class="icon write-article" data-v-17cc1c49></div> <div class="title" data-v-17cc1c49>写文章</div></li><li class="item" data-v-17cc1c49><div class="icon issue-points" data-v-17cc1c49></div> <div class="title" data-v-17cc1c49>发沸点</div></li><li class="item" data-v-17cc1c49><div class="icon write-note" data-v-17cc1c49></div> <div class="title" data-v-17cc1c49>写笔记</div></li><li class="item" data-v-17cc1c49><div class="icon create-jcode" data-v-17cc1c49></div> <div class="title" data-v-17cc1c49>写代码</div></li><li class="item" data-v-17cc1c49><div class="icon drafts" data-v-17cc1c49></div> <div class="title" data-v-17cc1c49>草稿箱</div></li></ul> <div class="divider" data-v-17cc1c49></div> <div class="inspiration" data-v-17cc1c49><div class="info" data-v-17cc1c49><span class="title" data-v-17cc1c49>创作灵感</span> <span class="more-info" data-v-17cc1c49>
            查看更多
            <i class="icon byte-icon byte-icon--right" data-v-17cc1c49><svg t="1561636167146" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="404349" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M630.4 512L283.52 165.12a21.12 21.12 0 0 1 0-30.08l30.08-30.08a21.12 21.12 0 0 1 30.08 0l377.6 376.96a42.24 42.24 0 0 1 0 60.16l-377.6 376.96a21.12 21.12 0 0 1-30.08 0l-30.08-30.08a21.12 21.12 0 0 1 0-30.08z" p-id="404350"></path></svg></i></span></div> <div class="list" data-v-17cc1c49>  <div class="item" data-v-21339fef data-v-17cc1c49><div class="xitu-skeleton xitu-skeleton-animated" data-v-21339fef><div class="xitu-skeleton-item" data-v-21339fef><!----> <div class="xitu-skeleton-content" style="padding:20px;" data-v-21339fef><div class="xitu-skeleton-line" data-v-21339fef></div><div class="xitu-skeleton-line" data-v-21339fef></div><div class="xitu-skeleton-line" data-v-21339fef></div></div></div></div></div></div></div></div></div> <!----></div></li></ul></li> <li class="nav-item vip-entry" data-v-732a5c08><div class="vip-title" data-v-732a5c08><div class="vip-entry-img" data-v-732a5c08><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ffd3e238ee7f46eab42bf88af17f5528~tplv-k3u1fbpfcp-image.image#?w=25&h=26&s=5968&e=svg&a=1&b=dacbbc" alt="vip" class="vip-img" data-v-732a5c08> <!----></div> <div class="vip-words" data-v-732a5c08>会员</div></div></li> <!----> <!----> <!----> <li class="nav-item auth hidden" data-v-732a5c08><div class="login-button-wrap" data-v-732a5c08><button class="login-button" data-v-732a5c08>
                登录
                <div class="login-button-inner" data-v-732a5c08><div class="login-button-line" data-v-732a5c08></div>
                  注册
                </div></button> <!----></div></li></ul></ul></nav></div></header></div>  <main class="container main-container" style="max-width:1140px;" data-v-cd15ceae><div class="view column-view" data-v-cd15ceae data-v-7cdd11fb><!----> <div class="main-area article-area" data-v-cd15ceae data-v-7cdd11fb><article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="6844903960826888206" data-draft-id="6845076490250371085" data-original-type="0" class="article" data-v-7cdd11fb><meta itemprop="url" content="https://juejin.im/post/6844903960826888206"> <meta itemprop="headline" content="vue3中effect与computed的亲密关系"> <meta itemprop="keywords" content="Vue.js"> <meta itemprop="datePublished" content="2019-10-10T15:39:26.000Z"> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="全栈技匠"> <meta itemprop="url" content="https://juejin.cn/user/3421335916389165"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <h1 class="article-title" data-v-7cdd11fb>
            vue3中effect与computed的亲密关系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-7cdd11fb><div class="author-info-box" data-v-7cdd11fb><div class="author-name" data-v-7cdd11fb><a href="/user/3421335916389165/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51 data-v-1800aadb data-v-7cdd11fb><span class="name" style="max-width:160px;" data-v-65b50b51 data-v-1800aadb>
    全栈技匠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-7cdd11fb><time datetime="2019-10-10T15:39:26.000Z" title="Thu Oct 10 2019 15:39:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-7cdd11fb>
                    2019-10-10
                  </time> <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-7cdd11fb><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-7cdd11fb></path><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-7cdd11fb></circle></svg> <span class="views-count" data-v-7cdd11fb>
                    3,162
                  </span> <span class="read-time" data-v-7cdd11fb><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-7cdd11fb><rect width="16" height="16" fill="none" data-v-7cdd11fb></rect><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-7cdd11fb></circle><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-7cdd11fb></path></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-7cdd11fb></div> <!----> <!----></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-7cdd11fb><div class="article-viewer markdown-body cache legacy"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight data-highlight-key="juejin"></style><blockquote>
<p>在我刚看完vue3响应式的时候，心中就有一个不可磨灭的谜团，让我茶不思饭不想，总想生病。那么这个谜团是什么呢？就是在响应式中一直穿行在tranger跟track之间的effect。如果单纯的响应式原理根本就用不上effect，那么effect到底是干什么的呢？</p>
</blockquote>
<h4 class="heading" data-id="heading-0">船到桥头自然直，柳岸花明又一村。苦心人天不负，偶然间我看到了effect测试代码用例！</h4>
<pre><code class="hljs js" lang="js">it(<span class="hljs-string">'should observe basic properties'</span>, () => {
  <span class="hljs-keyword">let</span> dummy
  <span class="hljs-keyword">const</span> counter = reactive({ <span class="hljs-attr">num</span>: <span class="hljs-number">0</span> })
  effect(<span class="hljs-function"><span class="hljs-params">()</span> =></span> (dummy = counter.num))

  expect(dummy).toBe(<span class="hljs-number">0</span>)
  counter.num = <span class="hljs-number">7</span>
  expect(dummy).toBe(<span class="hljs-number">7</span>)
})
</code></pre><p>解释一下，这段代码</p>
<ul>
<li>首先声明dummy变量，然后在effect的回调中把已响应的对象counter的num属性赋值给dummy</li>
<li>然后做断言判断 dummy是否等于 0</li>
<li>将 counter.num 赋值 7 ，然后 dummy 也变成了 7 ！</li>
</ul>
<p>这，，，让我想到了什么？？</p>
<h5 class="heading" data-id="heading-1">这就是computed的吗？</h5>
<p>赶紧看下 computed 的测试用例！！</p>
<pre><code class="hljs js" lang="js"><span class="hljs-keyword">const</span> value = reactive&#x3C;{ foo?: number }>({})
<span class="hljs-keyword">const</span> cValue = computed(<span class="hljs-function"><span class="hljs-params">()</span> =></span> value.foo)
expect(cValue.value).toBe(<span class="hljs-literal">undefined</span>)
value.foo = <span class="hljs-number">1</span>
expect(cValue.value).toBe(<span class="hljs-number">1</span>)
</code></pre><p>哈哈哈</p>
<p>阿哈哈哈哈</p>
<p>hhhhhhhhhhhhhhhhhhhh</p>
<p>忍不住想仰天长啸！！</p>
<blockquote>
<p>果然跟我猜想的一样！！！我终于直到effect是个什么鬼了，顾名思义effect是副作用的意思，也就是说它是响应式副产品，每次触发了 get 时收集effect，每次set时在触发这些effects。这样就可以做一些响应式数据之外的一些事情了，比如计算属性computed。</p>
</blockquote>
<h4 class="heading" data-id="heading-2">让我们用effect实现一个computed 可能会更清晰一点</h4>
<p>我就不写一些乱七八糟的判断了，让大家能够看的更加清楚</p>
<pre><code class="hljs js" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">computed</span> (<span class="hljs-params">fn</span>) </span>{
  <span class="hljs-keyword">let</span> value = <span class="hljs-literal">undefined</span>
  <span class="hljs-keyword">const</span> runner = effect(fn, {
    <span class="hljs-comment">// 如果lazy不置为true的话，每次创建effect的时候都会立即执行一次</span>
    <span class="hljs-comment">// 而我们要实现computed显然是不需要的</span>
    lazy: <span class="hljs-literal">true</span>
  })
  <span class="hljs-comment">// 为什么要使用对象的形式，是因为我们最后需要得到computed的值</span>
  <span class="hljs-comment">// 如果不用对象的 get 方法的话我们就需要手动再调用一次 computed() </span>
  <span class="hljs-keyword">return</span> {
    get value() {
      <span class="hljs-keyword">return</span> runner()
    }
  }
}

<span class="hljs-comment">// 使用起来是这样的</span>

<span class="hljs-keyword">const</span> value = reactive({})
<span class="hljs-keyword">const</span> cValue = computed(<span class="hljs-function"><span class="hljs-params">()</span> =></span> value.foo)
value.foo = <span class="hljs-number">1</span>

<span class="hljs-built_in">console</span>.log(cValue.value) <span class="hljs-comment">// 1</span>
</code></pre><h4 class="heading" data-id="heading-3">这也太简单了吧，那么重点来了，effect怎么实现的呢？</h4>
<p>别着急，我们先捋一下逻辑</p>
<ol>
<li>首先 如果 effect 回调内有已响应的对象被触发了 get 时，effect就应该被储存起来</li>
<li>然后，我们需要一个储存effect的地方，在effect函数调用的时候就应该把effect放进这个储存空间，在vue中使用的是一个数组activeReactiveEffectStack = []</li>
<li>再后，每个target被触发的时候，都可能有多个effect，所以每个target需要有一个对应的依赖收集器 deps，等到 set 时遍历 deps 执行 effect()</li>
<li>然而，这个依赖收集器 deps 不能放在 target 本身上，这样会使数据看起来不是很简洁，还会存在多余无用的数据，所以我们需要一个 map 集合来储存 target 跟 deps 的关系， 在vue中这个储存集合叫 targetMap 。</li>
</ol>
<h5 class="heading" data-id="heading-4">几个概念</h5>
<ol>
<li>track 追踪器，在 get 时调用该函数，将所有 get 的 target 跟 key 以及 effect 建立起对应关系</li>
</ol>
<pre><code class="hljs js" lang="js"><span class="hljs-comment">// 比如 const react = reactive({a: { b: 2 })</span>
<span class="hljs-comment">// react.a 时 target -> {a: { b: 2 } key -> a </span>
<span class="hljs-comment">// targetMap 储存了 target --> Map --> key --> Set --> dep --> effect </span>
<span class="hljs-comment">// 当调用 react.a.b.c.d.e 时 depsMap</span>
<span class="hljs-comment">// {"a" => Set(1)} --> Set --> effect</span>
<span class="hljs-comment">// {"b" => Set(1)}</span>
<span class="hljs-comment">// {"c" => Set(1)}</span>
<span class="hljs-comment">// {"d" => Set(1)}</span>
<span class="hljs-comment">// {"e" => Set(1)}</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">track</span>(<span class="hljs-params">target: any, key: string</span>) </span>{
  <span class="hljs-keyword">const</span> effect = activeReactiveEffectStack[activeReactiveEffectStack.length - <span class="hljs-number">1</span>];
  <span class="hljs-keyword">if</span> (effect) {
    <span class="hljs-keyword">let</span> depsMap = targetMap.get(target);
    <span class="hljs-keyword">if</span> (depsMap === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) {
      targetMap.set(target, (depsMap = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>()));
    }
    <span class="hljs-keyword">let</span> dep = depsMap.get(key!);
    <span class="hljs-keyword">if</span> (!dep) {
      depsMap.set(key!, (dep = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>()));
    }
    <span class="hljs-keyword">if</span> (!dep.has(effect)) {
      dep.add(effect);
      effect.deps.push(dep);
    }
  }
}
</code></pre><ol start="2">
<li>trigger 触发器，这个就比较好理解了，拿到target key下的对应的所有 effect，然后遍历执行 effect()</li>
</ol>
<pre><code class="hljs js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trigger</span>(<span class="hljs-params">target: any, key?: string | symbol</span>) </span>{
  <span class="hljs-keyword">const</span> depsMap: any = targetMap.get(target);
  <span class="hljs-keyword">const</span> effects: any = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>()
  <span class="hljs-keyword">if</span> (depsMap &#x26;&#x26; depsMap.get(key)) {
    depsMap.get(key).forEach(<span class="hljs-function">(<span class="hljs-params">dep: any</span>) =></span> {
      effects.add(dep)
    });
    effects.forEach(<span class="hljs-function">(<span class="hljs-params">e: any</span>) =></span> e())
  }
}
</code></pre><ol start="3">
<li>effect 函数实现</li>
</ol>
<pre><code class="hljs js" lang="js"><span class="hljs-comment">// 暴露的 effect 函数</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">effect</span>(<span class="hljs-params">
  fn: Function,
  options: any = EMPTY_OBJ
</span>): <span class="hljs-title">any</span> </span>{
  <span class="hljs-keyword">if</span> ((fn <span class="hljs-keyword">as</span> any).isEffect) {
    fn = (fn <span class="hljs-keyword">as</span> any).raw
  }
  <span class="hljs-keyword">const</span> effect = createReactiveEffect(fn, options)
  <span class="hljs-comment">// 如果不是 lazy，则会立即执行一次</span>
  <span class="hljs-keyword">if</span> (!options.lazy) {
    effect()
  }
  <span class="hljs-keyword">return</span> effect
}

<span class="hljs-comment">// 创建 effect</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createReactiveEffect</span>(<span class="hljs-params">
  fn: Function,
  options: any
</span>): <span class="hljs-title">any</span> </span>{
  <span class="hljs-keyword">const</span> effect = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">effect</span>(<span class="hljs-params">...args: any</span>): <span class="hljs-title">any</span> </span>{
    <span class="hljs-keyword">return</span> run(effect <span class="hljs-keyword">as</span> any, fn, args)
  } <span class="hljs-keyword">as</span> any
  effect.isEffect = <span class="hljs-literal">true</span>
  effect.active = <span class="hljs-literal">true</span>
  effect.raw = fn
  effect.scheduler = options.scheduler
  effect.onTrack = options.onTrack
  effect.onTrigger = options.onTrigger
  effect.onStop = options.onStop
  effect.computed = options.computed
  effect.deps = []
  <span class="hljs-keyword">return</span> effect
}

<span class="hljs-comment">// 执行函数，执行完之后会将储存的 effect 删除</span>
<span class="hljs-comment">// 这是函数 effect 的所有执行，所经历的完整的声明周期</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params">effect: any, fn: Function, args: any[]</span>): <span class="hljs-title">any</span> </span>{
  <span class="hljs-keyword">if</span> (!effect.active) {
    <span class="hljs-keyword">return</span> fn(...args)
  }
  <span class="hljs-keyword">if</span> (activeReactiveEffectStack.indexOf(effect) === <span class="hljs-number">-1</span>) {
    <span class="hljs-keyword">try</span> {
      activeReactiveEffectStack.push(effect)
      <span class="hljs-keyword">return</span> fn(...args)
    } <span class="hljs-keyword">finally</span> {
      activeReactiveEffectStack.pop()
    }
  }
}
</code></pre><blockquote>
<p>一口气写了这么多，最后总结一下。在大家看源码的时候，如果发现有哪个地方无从下手的话，可以先从测试用例开始看。因为测试用例可以很清楚的知道这个函数想要达到什么效果，然后从效果上想，为什么这么做，如果我自己写的话应该怎么写，这样一点点就能揣摩出作者的意图了。再根据源码结合自己的想法你就能够学到很多。</p>
</blockquote>
</div></div></article> <div class="article-end" data-v-cd15ceae data-v-7cdd11fb><div class="rank-entry-bottom" data-v-cd15ceae data-v-7cdd11fb><!----></div> <div class="tag-list-box" data-v-cd15ceae data-v-7cdd11fb><!----><!----><!----></div></div> <!----><!----><!----><!----><!----></div> <div id="sidebar-container" class="sidebar article-sidebar" data-v-02b802e8 data-v-7cdd11fb><div class="sidebar-block author-block author-block-container pure" data-v-7e7e812a data-v-a6d177e4 data-v-02b802e8><a href="/user/3421335916389165/posts" target="_blank" rel="" class="jj-link user-item item" data-v-65b50b51 data-v-a6d177e4><div class="avatar jj-avatar avatar" data-v-03256cc6 data-v-a6d177e4><img loading="eager" src="https://p6-passport.byteacctimg.com/img/user-avatar/a323282e3d3a1ad31221af3df77577f4~200x200.image" alt="avatar" class="lazy avatar-img immediate" data-v-5244ef91 data-v-03256cc6> </div> <div class="info-box" style="visibility:hidden;" data-v-65b50b51 data-v-a6d177e4><span to="[object Object]" blank="true" class="username" data-v-1800aadb data-v-a6d177e4><span class="name" style="max-width:128px;" data-v-1800aadb>
    全栈技匠
  </span> <span to="" blank="true" class="rank" data-v-23743940 data-v-1800aadb><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="创作等级LV.5" title="创作等级LV.5" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91 data-v-23743940></span> <!----> <!----> </span> <div title="前端 @公众号-前端技匠" class="position" data-v-65b50b51 data-v-a6d177e4>
        前端 @公众号-前端技匠
      </div> <div class="extra-container" data-v-65b50b51 data-v-a6d177e4><!----> </div></div></a> <div class="count-container" data-v-7e7e812a data-v-a6d177e4><a href="/user/3421335916389165/posts" target="_blank" rel="" class="jj-link stat-item item" data-v-65b50b51 data-v-a6d177e4><div class="count" style="display:none;" data-v-65b50b51 data-v-a6d177e4>
        13
      </div> <div data-v-65b50b51 data-v-a6d177e4>文章</div></a> <a href="/user/3421335916389165/posts" target="_blank" rel="" class="jj-link stat-item item" data-v-65b50b51 data-v-a6d177e4><div class="count" style="display:none;" data-v-65b50b51 data-v-a6d177e4>
        161k
      </div> <div data-v-65b50b51 data-v-a6d177e4>阅读</div></a> <a href="/user/3421335916389165/followers" target="_blank" rel="" class="jj-link stat-item item" data-v-65b50b51 data-v-a6d177e4><div class="count" style="display:none;" data-v-65b50b51 data-v-a6d177e4>
        3.6k
      </div> <div data-v-65b50b51 data-v-a6d177e4>粉丝</div></a></div> <div class="operate-btn hidden" style="position:relative;z-index:2;min-height:36px;" data-v-7e7e812a data-v-a6d177e4><!----><!----><!----></div> <!----></div> <div class="sticky-block-box" data-v-02b802e8><nav class="article-catalog catalog-block none" data-v-6239701c data-v-16ed86c3 data-v-02b802e8><div class="catalog-title" data-v-6239701c><div data-v-6239701c>目录</div> <div class="direction" data-v-6239701c><div class="word" data-v-6239701c>收起</div> <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-rotate" data-v-6239701c data-v-6239701c><g id="&amp;#229;&amp;#177;&amp;#149;&amp;#229;&amp;#188;&amp;#128;" data-v-6239701c data-v-6239701c><path id="&amp;#232;&amp;#183;&amp;#175;&amp;#229;&amp;#190;&amp;#132;" fill-rule="evenodd" clip-rule="evenodd" d="M5.99854 7.93206L10.0644 3.86619C10.162 3.76856 10.3203 3.76856 10.418 3.86619L10.7715 4.21975C10.8691 4.31738 10.8691 4.47567 10.7715 4.5733L6.35209 8.99272C6.15683 9.18798 5.84025 9.18798 5.64498 8.99272L1.22557 4.5733C1.12794 4.47567 1.12794 4.31738 1.22557 4.21975L1.57912 3.86619C1.67675 3.76856 1.83504 3.76856 1.93267 3.86619L5.99854 7.93206Z" fill="#8A919F" data-v-6239701c data-v-6239701c></path></g></svg></div></div> <div class="catalog-body unfold" data-v-6239701c><ul class="catalog-list" style="margin-top:0px;" data-v-6239701c><li class="item d1" data-v-6239701c><div class="a-container"><a href="#heading-0" title="船到桥头自然直，柳岸花明又一村。苦心人天不负，偶然间我看到了effect测试代码用例！" class="catalog-aTag d1-aTag-title">
      船到桥头自然直，柳岸花明又一村。苦心人天不负，偶然间我看到了effect测试代码用例！
    </a></div> <ul class="sub-list"><li class="item d2"><div class="a-container"><a href="#heading-1" title="这就是computed的吗？" class="catalog-aTag d2-aTag-title">
      这就是computed的吗？
    </a></div> <!----></li></ul></li><li class="item d1" data-v-6239701c><div class="a-container"><a href="#heading-2" title="让我们用effect实现一个computed 可能会更清晰一点" class="catalog-aTag d1-aTag-title">
      让我们用effect实现一个computed 可能会更清晰一点
    </a></div> <!----></li><li class="item d1" data-v-6239701c><div class="a-container"><a href="#heading-3" title="这也太简单了吧，那么重点来了，effect怎么实现的呢？" class="catalog-aTag d1-aTag-title">
      这也太简单了吧，那么重点来了，effect怎么实现的呢？
    </a></div> <ul class="sub-list"><li class="item d2"><div class="a-container"><a href="#heading-4" title="几个概念" class="catalog-aTag d2-aTag-title">
      几个概念
    </a></div> <!----></li></ul></li></ul></div></nav> <!----> <!----> <!----> <!----></div> <div class="adverts-list" data-v-0eca8145 data-v-02b802e8></div> <!----></div> <!----> <!----> <div id="article-suspended-panel" data-v-cd15ceae data-v-7cdd11fb></div> <!----></div> <!----><!----><!----><!----><!----><!----><!----></main> <!----></div> <!----> <div class="global-component-box"><!----></div> <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----> <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O){r.loading=a;r.skeleton=d;r.cursor=f;r.data=[];r.total=b;r.hasMore=d;F.id=u;F.self_description=m;F.followed=a;F.viewerIsFollowing=m;F.community=m;F.subscribedTagCount=b;F.wroteBookCount=b;F.boughtBookCount=b;F.isBindedPhone=a;F.level=j;F.user_id=u;F.user_name=C;F.company="公众号-前端技匠";F.job_title="前端";F.avatar_large="https:\u002F\u002Fp6-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002Fa323282e3d3a1ad31221af3df77577f4~300x300.image";F.description="专业markdown工程师";F.followee_count=161;F.follower_count=3606;F.post_article_count=13;F.digg_article_count=152;F.got_digg_count=3749;F.got_view_count=160604;F.post_shortmsg_count=26;F.digg_shortmsg_count=6;F.isfollowed=a;F.favorable_author=g;F.power=D;F.study_point=b;F.university={university_id:f,name:e,logo:e};F.major={major_id:f,parent_id:f,name:e};F.student_status=b;F.select_event_count=b;F.select_online_course_count=b;F.identity=b;F.is_select_annual=a;F.select_annual_rank=b;F.annual_list_type=b;F.extraMap={};F.is_logout=b;F.annual_info=[];F.account_amount=b;F.user_growth_info={user_id:3421335916389165,jpower:D,jscore:328,jpower_level:j,jscore_level:4,jscore_title:"进阶掘友",author_achievement_list:[g],vip_level:b,vip_title:e,jscore_next_level_score:500,jscore_this_level_mini_score:150,vip_score:b};F.is_vip=a;F.become_author_days=b;F.collection_set_article_count=b;F.recommend_article_count_daily=b;F.article_collect_count_daily=b;F.user_priv_info={administrator:b,builder:b,favorable_author:b,book_author:b,forbidden_words:b,can_tag_cnt:b,auto_recommend:b,signed_author:b,popular_author:b,can_add_video:b};F.juejinPower=D;F.jobTitle="前端";F.roles={isBookAuthor:a,isFavorableAuthor:d,isCobuilder:a,isAdmin:a};F.username=C;F.blogAddress=m;F.selfDescription="专业markdown工程师";F.beLikedCount=3749;F.beReadCount=160604;F.followerCount=3606;F.followingCount=161;F.collectionCount=b;F.createdCollectionCount=b;F.followingCollectionCount=b;F.postedPostsCount=13;F.pinCount=26;F.likedArticleCount=152;F.likedPinCount=6;F.avatar="https:\u002F\u002Fp6-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002Fa323282e3d3a1ad31221af3df77577f4~300x300.image";F.latestLoginedInAt=c;F.createdAt=c;F.updatedAt=c;F.phoneNumber=e;F.titleDescription=e;F.followeesCount=161;F.applyEventCount=b;F.need_lead=b;F.followTopicCnt=b;return {layout:"default",data:[{renderPost:d}],fetch:{"data-v-732a5c08:0":{queryString:e,isShowUserDropdownList:a,isShowAddMoreList:a,isFocus:a,isPhoneMenuShow:a,visibleBadge:a,placeholder:e,hiddenProperty:"hidden",searchHistoryVisible:a,searchHistoryItems:[],tabBadge:c,isChangePlaceholder:d,showMallBridge:a,showAIProblemBridge:a,removeSearchInputKeyupListener:c,logoImg:"\u002F\u002Flf-web-assets.juejin.cn\u002Fobj\u002Fjuejin-web\u002Fxitu_juejin_web\u002Fe08da34488b114bd4c665ba2fa520a31.svg"}},error:c,state:{view:{activityIndex:{activityList:[],pageInfo:{hasNextPage:a,endCursor:e},afterPosition:e,activityListIsLoading:d,activityListIsError:a,userActivityList:[],placeholder:e,actionType:{FETCH:"@\u002Fview\u002Factivity-index\u002FFETCH",FETCH_RECOMMEND_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_RECOMMEND_LIST",RESET_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FRESET_ACTIVITY_LIST",FETCH_USER_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_USER_ACTIVITY_LIST",FETCH_NEW_COUNT:"@\u002Fview\u002Factivity-index\u002FFETCH_NEW_COUNT",DELETE_ACTIVITY:"@\u002Fview\u002Factivity-index\u002FDELETE_ACTIVITY",TOGGLE_FOLLOW_USER:"@\u002Fview\u002Factivity-index\u002FTOGGLE_FOLLOW_USER",FETCH_ENTRY_COMMENT_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_ENTRY_COMMENT_LIST",UPDATE_LIST_LOADING:"@\u002Fview\u002Factivity-index\u002FUPDATE_LIST_LOADING",RESET:"@\u002Fview\u002Factivity-index\u002FRESET"},hotList:{list:[],after:e,loading:a,hasNextPage:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FRESET"}},sidebar:{bannerList:[],actionType:{RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FUPDATE_STATE",FETCH_BANNER:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FFETCH_BANNER"},recommend:{pageSize:h,page:b,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FRESET"},after:b},followed:{pageSize:h,page:b,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FRESET"},after:b},recommendPin:{list:[],after:e,loading:a,hasNextPage:d,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FRESET"}}},topicPinList:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FRESET"},topicId:e,navList:[{type:k,name:k,title:"推荐 ",id:k},{type:n,name:n,title:"热门 ",id:n},{type:p,name:p,title:"关注 ",id:p},{type:i,name:"opensource",title:"开源推荐 ",id:"5c09ea2b092dcb42c740fe73"},{type:i,name:"recruitment",title:"内推招聘",id:"5abb61e1092dcb4620ca3322"},{type:i,name:"dating",title:"掘金相亲",id:"5abcaa67092dcb4620ca335c"},{type:i,name:"slacking",title:"上班摸鱼",id:"5c106be9092dcb2cc5de7257"},{type:i,name:"app",title:"应用安利",id:"5b514af1092dcb61bd72800d"},{type:i,name:"tool",title:"开发工具",id:"5abb67d2092dcb4620ca3324"},{type:i,name:"news",title:"New资讯",id:"5c46a17f092dcb4737217152"}],sortType:q}},search:{search_result_from:b,query:e,list:[],linkList:[],loading:a,skeleton:d,actionType:{FETCH:"@\u002Fview\u002Fsearch\u002FFETCH",FETCH_MORE:"@\u002Fview\u002Fsearch\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fsearch\u002FRESET"}},columnIndex:{list:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FRESET"},sort:o,category:"all"},hotList:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FRESET"}}},timelineIndex:{tdkTemplates:[],categoryNavList:[],tagNavList:[],splitTagList:[],timelineAdList:[],list:[],sort:q,category:k,categoryId:e,tagId:e,tag:"全部",actionType:{FETCH_TIMELINE_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TIMELINE_LIST",FETCH_CATEGORY_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_CATEGORY_LIST",FETCH_TAG_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TAG_LIST",DELETE_ENTRY:"@\u002Fview\u002FtimelineIndex\u002FDELETE_ENTRY",DELETE_USER_ENTRIES:"@\u002Fview\u002FtimelineIndex\u002FDELETE_USER_ENTRIES",DELETE_TAG_ENTRIES:"@\u002Fview\u002FtimelineIndex\u002FDELETE_TAG_ENTRIES",FETCH_MORE:"@\u002Fview\u002FtimelineIndex\u002FFETCH_MORE",FETCH:"@\u002Fview\u002FtimelineIndex\u002FFETCH",RESET:"@\u002Fview\u002FtimelineIndex\u002FRESET"},serverRenderTimelineList:a,timelineList:{list:[],cursor:f,skeleton:d,loading:a,hasMore:d,categoryId:e,tagId:e,sort:e,actionType:{UPDATE_STATE:"timeline-list\u002FUPDATE_STATE",FETCH_MORE:"timeline-list\u002FFETCH_MORE",FETCH:"timeline-list\u002FFETCH",RESET:"timeline-list\u002FRESET"}},recommendList:{list:[],cursor:f,sort:e,loading:a,skeleton:d,hasMore:d,actionType:{UPDATE_STATE:"recommend-list\u002FUPDATE_STATE",FETCH_MORE:"recommend-list\u002FFETCH_MORE",FETCH:"recommend-list\u002FFETCH",RESET:"recommend-list\u002FRESET"}},followingList:{list:[],cursor:f,skeleton:d,loading:a,hasMore:d,actionType:{UPDATE_STATE:"following-list\u002FUPDATE_STATE",FETCH_MORE:"following-list\u002FFETCH_MORE",FETCH:"following-list\u002FFETCH",RESET:"following-list\u002FRESET"}}},subscribe:{subscribed:{list:[],cursor:f,skeleton:d,loading:a,hasMore:a,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FRESET"}},all:{list:[],cursor:f,loading:a,skeleton:d,hasMore:a,linkList:e,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fall\u002Flist\u002FRESET"}}},entryPublic:{entry:{user:{}},relatedEntryList:[],relatedCollectionList:[],actionType:{FETCH:"@\u002Fview\u002FentryPublic\u002FFETCH",RESET:"@\u002Fview\u002FentryPublic\u002FRESET"}},user:{user:{},serverRendered:a,userAnnuals:[],actionType:{FETCH:"@\u002Fview\u002Fuser\u002FFETCH",RESET:"@\u002Fview\u002Fuser\u002FRESET",UPDATE:"@\u002Fview\u002Fuser\u002FUPDATE",FETCH_ANNUALS:"@\u002Fview\u002Fuser\u002FFETCH_ANNUALS"},detailList:{actionType:{RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FRESET"},likeList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FRESET"}},postList:{list:[],hasMore:a,skeleton:a,loading:a,sort:o,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FRESET"}},searchList:{list:[],hasMore:a,skeleton:a,loading:a,key_word:e,search_type:b,cursor:f,isPostSearch:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FRESET"}},tagList:{list:[],loading:a,skeleton:a,hasMore:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FRESET"}},collectionList:{list:[],userId:e,skeleton:a,hasMore:a,cursor:f,type:t,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FRESET",TOGGLE_FOLLOW_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FTOGGLE_FOLLOW_COLLECTION",FOLLOW_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFOLLOW_COLLECTION",UNFOLLOW_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FUNFOLLOW_COLLECTION",DELELTE_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FDELELTE_COLLECTION",ADD_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FADD_COLLECTION",EDIT_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FEDIT_COLLECTION"}},followerList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FRESET"}},followingList:{list:[],cursor:f,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FRESET"}},followingTeamsList:{list:[],cursor:f,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FRESET"}},activityList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FRESET"}},bookList:{list:[],cursor:f,skeleton:a,hasMore:a,loading:a,type:"wrote",actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FRESET"}},pinList:{list:[],hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FRESET"}},courseList:{list:[],hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FRESET"}},pinPraisedList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FRESET"}},eventList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FRESET"}},selfColumnList:{list:[],hasMore:a,skeleton:a,loading:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FRESET"}},columnFollowedList:{list:[],hasMore:a,skeleton:a,loading:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FRESET",FILTER:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FFILTER"}},realtimes:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FRESET",DELETE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FDELETE"}},realtimeliked:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FRESET",DELETE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FDELETE"}},robotList:{list:[],cursor:f,type:t,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FrobotList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FrobotList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FrobotList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FrobotList\u002FRESET"}}}},tag:{tag:{},actionType:{FETCH:"@\u002Fview\u002Ftag\u002FFETCH",FETCH_LIST:"@\u002Fview\u002Ftag\u002FFETCH_LIST",RESET:"@\u002Fview\u002Ftag\u002FRESET"},list:{list:[],cursor:f,loading:a,skeleton:a,hasMore:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Ftag\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH",RESET:"@\u002Fview\u002Ftag\u002Flist\u002FRESET"}}},notification:{user:{actionType:{RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002FRESET"},listState:{list:[],cursor:f,hasMore:a,isLoading:a,messageType:3,msgTotal:b,msgSubMap:{"1":b,"2":b,"3":b,"4":b,"7":b}},list:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FRESET"}}},system:{actionType:{RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002FRESET"},list:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FRESET"}}}},column:{serverRenderList:a,column:{id:l},entry:{id:l,screenshot:m,liked:a,article_id:l,article_info:{article_id:l,user_id:u,category_id:"6809637767543259144",tag_ids:[6809640369764958000],visible_level:b,link_url:v,cover_image:e,is_gfw:b,title:w,brief_content:x,is_english:b,is_original:g,user_index:2.7095112913515,original_type:b,original_author:e,content:y,ctime:"1570721966",mtime:"1598527511",rtime:"1570798714",draft_id:z,view_count:A,collect_count:j,digg_count:j,comment_count:b,hot_index:163,is_hot:b,rank_index:.0001554,status:g,verify_status:g,audit_status:B,mark_content:e,display_count:b,is_markdown:g,app_html_content:e,version:g,web_html_content:c,meta_info:"{\"plugins\":[5]}",catalog:"[{\"title\":\"船到桥头自然直，柳岸花明又一村。苦心人天不负，偶然间我看到了effect测试代码用例！\",\"hash\":\"#heading-0\",\"deep\":1,\"children\":[{\"title\":\"这就是computed的吗？\",\"hash\":\"#heading-1\",\"deep\":2,\"children\":[],\"visible\":true}],\"visible\":true},{\"title\":\"让我们用effect实现一个computed 可能会更清晰一点\",\"hash\":\"#heading-2\",\"deep\":1,\"children\":[],\"visible\":true},{\"title\":\"这也太简单了吧，那么重点来了，effect怎么实现的呢？\",\"hash\":\"#heading-3\",\"deep\":1,\"children\":[{\"title\":\"几个概念\",\"hash\":\"#heading-4\",\"deep\":2,\"children\":[],\"visible\":true}],\"visible\":true}]",homepage_top_time:-62135596800,homepage_top_status:b,content_count:1242,read_time:"4分钟"},author_user_info:{user_id:u,user_name:C,company:"公众号-前端技匠",job_title:"前端",avatar_large:"https:\u002F\u002Fp6-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002Fa323282e3d3a1ad31221af3df77577f4~300x300.image",level:j,description:"专业markdown工程师",followee_count:161,follower_count:3606,post_article_count:13,digg_article_count:152,got_digg_count:3749,got_view_count:160604,post_shortmsg_count:26,digg_shortmsg_count:6,isfollowed:a,favorable_author:g,power:D,study_point:b,university:{university_id:f,name:e,logo:e},major:{major_id:f,parent_id:f,name:e},student_status:b,select_event_count:b,select_online_course_count:b,identity:b,is_select_annual:a,select_annual_rank:b,annual_list_type:b,extraMap:{},is_logout:b,annual_info:[],account_amount:b,user_growth_info:{user_id:3421335916389165,jpower:D,jscore:328,jpower_level:j,jscore_level:4,jscore_title:"进阶掘友",author_achievement_list:[g],vip_level:b,vip_title:e,jscore_next_level_score:500,jscore_this_level_mini_score:150,vip_score:b},is_vip:a,become_author_days:b,collection_set_article_count:b,recommend_article_count_daily:b,article_collect_count_daily:b,user_priv_info:{administrator:b,builder:b,favorable_author:b,book_author:b,forbidden_words:b,can_tag_cnt:b,auto_recommend:b,signed_author:b,popular_author:b,can_add_video:b}},category:{category_id:"6809637767543259144",category_name:"前端",category_url:"frontend",rank:B,back_ground:"https:\u002F\u002Flc-mhke0kuv.cn-n1.lcfile.com\u002F8c95587526f346c0.png",icon:"https:\u002F\u002Flc-mhke0kuv.cn-n1.lcfile.com\u002F1c40f5eaba561e32.png",ctime:1457483942,mtime:1432503190,show_type:3,item_type:B,promote_tag_cap:4,promote_priority:B,id:"6809637767543259144",name:"前端",title:"前端",alias:"frontend"},tags:[{entriesCount:m,subscribed:a,id:"6809640369764958215",tag_id:"6809640369764958215",tag_name:"Vue.js",color:e,icon:"https:\u002F\u002Fp1-jj.byteimg.com\u002Ftos-cn-i-t2oaga2asx\u002Fleancloud-assets\u002F7b5c3eb591b671749fee.png~tplv-t2oaga2asx-image.image",back_ground:e,show_navi:b,ctime:1432234520,mtime:1726816910,id_type:9,tag_alias:"vue,Vue",post_article_count:73977,concern_user_count:448425,title:"Vue.js",tagId:"6809640369764958215",articleCount:73977,subscribersCount:448425,createdAt:c,updatedAt:c}],user_interact:{id:6844903960826888000,omitempty:B,user_id:b,is_digg:a,is_follow:a,is_collect:a,collect_set_count:b},org:{is_followed:a},req_id:"20240920152226F2DD8E9F15004F722F9C",status:{push_status:b},theme_list:[],extra:{currentVersion:"1",hasAuth:E,imageExpiredEvent:E},title:w,user:F,viewCount:m,commentsCount:b,isEvent:m,abstract:x,latestCommentAt:c,createdAt:new Date(1570721966000),updatedAt:c,isTopicEvent:a,likedCount:j,likeCount:j,content:y,originalUrl:v,type:"post",collected:a,viewsCount:A,username:C,viewerHasLiked:a,draftId:z,collectionCount:j,isCache:d},entryView:{},author:F,adEntryList:[],relatedEntryList:[],selectedList:[],linkVotingList:[],userAnnuals:[],columnList:[],hitArticleCache:d,authorCard:{},relatedLoaded:a,dynamicDataReady:a,followAuthorPopupTime:b,followAuthorPopupType:b,authorBlockVisible:b,compVisible:{},version:g,actionType:{FETCH:"view\u002Fcolumn\u002FFETCH",FETCH_RELATED:"view\u002Fcolumn\u002FFETCH_RELATED",FETCH_RECOMMEND:"view\u002Fcolumn\u002FFETCH_RECOMMEND",FETCH_SELECTED:"view\u002Fcolumn\u002FFETCH_SELECTED",FETCH_ADDITIONAL:"view\u002Fcolumn\u002FFETCH_ADDITIONAL",FETCH_SIDEBAR_ADENTRY:"view\u002Fcolumn\u002FFETCH_SIDEBAR_ADENTRY",FETCH_AUTHOR_EXTRA:"view\u002Fcolumn\u002FFETCH_AUTHOR_EXTRA",MD_FALLBACK_RENDER:"view\u002Fcolumn\u002FMD_FALLBACK_RENDER",RESET:"view\u002Fcolumn\u002FRESET"},recommendedArticleList:{list:[],cursor:f,loading:a,skeleton:a,hasMore:a,articleId:e,actionType:{UPDATE_STATE:"view\u002Fcolumn\u002Frecommend-List\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH_MORE",FETCH:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH",RESET:"view\u002Fcolumn\u002Frecommend-List\u002FRESET"}}},collection:{collection:{author:{}},actionType:{FETCH:"@\u002Fview\u002Fcollection\u002FFETCH",REFRESH:"@\u002Fview\u002Fcollection\u002FREFRESH",RESET:"@\u002Fview\u002Fcollection\u002FRESET"},list:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fcollection\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fcollection\u002Flist\u002FRESET"},id:e,sort:o}},gettingStarted:{category:{},actionType:{UPDATE_STATE:"@\u002Fview\u002FgettingStarted\u002FUPDATE_STATE",FOLLOW:"@\u002Fview\u002FgettingStarted\u002FFOLLOW",RESET:"@\u002Fview\u002FgettingStarted\u002FRESET",UPDATE_CATEGORY:"@\u002Fview\u002FgettingStarted\u002FUPDATE_CATEGORY"}},pin:{pin:{user:{},imageUrlList:[]},pinList:[],actionType:{FETCH:"@\u002Fview\u002Fpin\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002FRESET"},sidebar:{list:[],after:e,loading:a,isRecommend:a,hasNextPage:d,actionType:{UPDATE_STATE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002Fsidebar\u002FRESET"}},commentList:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FcommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FcommentList\u002FRESET"},pinId:c},subCommentList:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FRESET"},commentId:c}},topic:{topic:e,followedTopicList:[],actionType:{FETCH:"@\u002Fview\u002Ftopic\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002FUPDATE_STATE",RESET:"@\u002Fview\u002Ftopic\u002FRESET"},allTopicList:{pageSize:G,page:b,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FRESET"},sortType:n},pinlist:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FpinList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FpinList\u002FRESET"},sortType:q},sidebar:{actionType:{RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FUPDATE_STATE"},attender:{pageSize:h,page:g,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FRESET"},topicId:c}},followedList:{pageSize:G,page:b,total:b,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:d,canNext:d,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FRESET"},after:b}},recommendationIndex:{actionType:{FETCH_USER:"@\u002Fview\u002Frecommendation\u002FFETCH_USER",FETCH_MORE:"@\u002Fview\u002Frecommendation\u002FFETCH_MORE",RESET:"@\u002Fview\u002Frecommendation\u002FRESET",FETCH:"@\u002Fview\u002Frecommendation\u002FFETCH"},cursor:e,hasMore:e,userList:[],loading:a,skeleton:d,category:k,categoryNavList:[],serverRenderUserList:a},event:{event:{},loading:a,user:{},actionType:{FETCH:"view\u002Fevent\u002FFETCH",RESET:"view\u002Fevent\u002FRESET"}},coursesIndex:{loading:a,list:[],sort:"online",actionType:{FETCH:"view\u002Fcourses\u002FFETCH",RESET:"view\u002Fcourses\u002FRESET",FETCH_MORE:"view\u002Fcourses\u002FFETCH_MORE"}},team:{team:{},loading:d,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FFETCH",RESET:"@\u002Fview\u002Fteam\u002FRESET",UPDATE:"@\u002Fview\u002Fteam\u002FUPDATE",FOLLOW:"@\u002Fview\u002Fteam\u002FFOLLOW"},detailList:{actionType:{RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002FRESET"},posts:{list:[],hasMore:a,skeleton:a,loading:a,sort:o,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FRESET"}},pins:{list:[],hasMore:a,loading:a,skeleton:d,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FRESET"}},hire:{list:[],hasMore:a,cursor:f,loading:a,skeleton:d,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FRESET"}}}},couponList:{list:{"0":r,"1":r,"2":r},showTooltip:a},payment:{selectedDiscount:{},bookletDetail:{},coupons:{availables:[],unavailables:[]},discountList:[]},activityVip:{selectedVipSku:{}}},component:{indexAside:{bannerList:[],userList:[],botList:[],botCursor:e,actionType:{FETCH_BANNER:"@\u002Fcomponent\u002Faside\u002FFETCH_BANNER",FETCH_USER:"@\u002Fcomponent\u002Faside\u002FFETCH_USER",CLOSE_BANNER:"@\u002Fcomponent\u002Faside\u002FCLOSE_BANNER",FETCH_BOT:"@\u002Fcomponent\u002Faside\u002FFETCH_BOT"}}},dislike:{whiteList:["1398234521548542",H,I,J,K,L,M],officialList:[H,I,"3984285868490807",J,"3562073405009031",K,"4433674252325966","53218623894222","2110693287406632","2498524693925623","430664288836334",L,M,"2832783991648407","3386151545092589"]},ore:{oreCount:b},avatarMenuInfo:{user_basic:{},user_counter:{},user_growth_info:{}},common:{theme:"light",isFollowSystem:a},env:{ua:"Mozilla\u002F5.0 (compatible; Barkrowler\u002F0.9; +https:\u002F\u002Fbabbar.tech\u002Fcrawler)",serverEnv:"production",logId:"20241228073346FF3D1B9ABA405A57CC6F"},auth:{user:c,clientId:c,token:c,qrCode:c,qrCodeStatus:c,qrCodeToken:c,userInitiated:a,loginTeaParams:m},tag:{subscribedTagList:[]},entry:{isLikeLoading:a},collection:{},comment:{},bookComment:{},repoComment:{},category:{list:[]},user:{subscribedTagList:[]},notification:{unreadCount:{user:b,system:b,total:b}},error:{location:c,errorView:c,statusCode:200,needRiskModal:a,riskAppealUrl:e},abTest:{info:{}},suspensionPanel:{needSuspension:d},pinComment:{},pin:{deleteDialogVisible:a,reportDialogVisible:a,targetPin:c,isOnFocus:a},topic:{visible:a},activity:{"2020":{},offer:{is_show:b,start_time:b},voteData:m},header:{leadStep:b,isPopupZlink:a},tcc:{tccConfig:c},adAssets:{adverts:[]},route:{name:N,path:s,hash:e,query:{},params:{id:l},fullPath:s,meta:{isAvailableDarkMode:d},from:{name:c,path:O,hash:e,query:{},params:{},fullPath:O,meta:{}}}},serverRendered:d,routePath:s,config:{API_HOST:"api.juejin.cn",CAPTCHA_HOST:"verify.snssdk.com",PLATFORM_APPID:{wechat:1277,weibo:1276,github:1045,wechatApp:1070},SCM_VERSION:"1.0.0.532",REGISTERED_ROUTES:[N,"selfPost","noCDNPost","SeoSearch"]},globalRefs:{}}}(false,0,null,true,"","0",1,20,"topic",5,"recommended","6844903960826888206",void 0,"hot","newest","following","popular",{},"\u002Fpost\u002F6844903960826888206","created","3421335916389165","https:\u002F\u002Fjuejin.im\u002Fpost\u002F6844903960826888206","vue3中effect与computed的亲密关系","船到桥头自然直，柳岸花明又一村。苦心人天不负，偶然间我看到了effect测试代码用例！ 然而，这个依赖收集器 deps 不能放在 target 本身上，这样会使数据看起来不是很简洁，还会存在多余无用的数据，所以我们需要一个 map 集合来储存 target 跟 deps 的关系…","\u003Cstyle\u003E.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre\u003Ecode{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:\"\"}.markdown-body blockquote\u003Ep{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}\u003C\u002Fstyle\u003E\u003Cstyle data-highlight data-highlight-key=\"juejin\"\u003E\u003C\u002Fstyle\u003E\u003Cblockquote\u003E\n\u003Cp\u003E在我刚看完vue3响应式的时候，心中就有一个不可磨灭的谜团，让我茶不思饭不想，总想生病。那么这个谜团是什么呢？就是在响应式中一直穿行在tranger跟track之间的effect。如果单纯的响应式原理根本就用不上effect，那么effect到底是干什么的呢？\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch4 class=\"heading\" data-id=\"heading-0\"\u003E船到桥头自然直，柳岸花明又一村。苦心人天不负，偶然间我看到了effect测试代码用例！\u003C\u002Fh4\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs js\" lang=\"js\"\u003Eit(\u003Cspan class=\"hljs-string\"\u003E'should observe basic properties'\u003C\u002Fspan\u003E, () =\u003E {\n  \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E dummy\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E counter = reactive({ \u003Cspan class=\"hljs-attr\"\u003Enum\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E })\n  effect(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E =\u003E\u003C\u002Fspan\u003E (dummy = counter.num))\n\n  expect(dummy).toBe(\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\n  counter.num = \u003Cspan class=\"hljs-number\"\u003E7\u003C\u002Fspan\u003E\n  expect(dummy).toBe(\u003Cspan class=\"hljs-number\"\u003E7\u003C\u002Fspan\u003E)\n})\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E解释一下，这段代码\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E首先声明dummy变量，然后在effect的回调中把已响应的对象counter的num属性赋值给dummy\u003C\u002Fli\u003E\n\u003Cli\u003E然后做断言判断 dummy是否等于 0\u003C\u002Fli\u003E\n\u003Cli\u003E将 counter.num 赋值 7 ，然后 dummy 也变成了 7 ！\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E这，，，让我想到了什么？？\u003C\u002Fp\u003E\n\u003Ch5 class=\"heading\" data-id=\"heading-1\"\u003E这就是computed的吗？\u003C\u002Fh5\u003E\n\u003Cp\u003E赶紧看下 computed 的测试用例！！\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs js\" lang=\"js\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E value = reactive&#x3C;{ foo?: number }\u003E({})\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E cValue = computed(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E =\u003E\u003C\u002Fspan\u003E value.foo)\nexpect(cValue.value).toBe(\u003Cspan class=\"hljs-literal\"\u003Eundefined\u003C\u002Fspan\u003E)\nvalue.foo = \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E\nexpect(cValue.value).toBe(\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E)\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E哈哈哈\u003C\u002Fp\u003E\n\u003Cp\u003E阿哈哈哈哈\u003C\u002Fp\u003E\n\u003Cp\u003Ehhhhhhhhhhhhhhhhhhhh\u003C\u002Fp\u003E\n\u003Cp\u003E忍不住想仰天长啸！！\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E果然跟我猜想的一样！！！我终于直到effect是个什么鬼了，顾名思义effect是副作用的意思，也就是说它是响应式副产品，每次触发了 get 时收集effect，每次set时在触发这些effects。这样就可以做一些响应式数据之外的一些事情了，比如计算属性computed。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch4 class=\"heading\" data-id=\"heading-2\"\u003E让我们用effect实现一个computed 可能会更清晰一点\u003C\u002Fh4\u003E\n\u003Cp\u003E我就不写一些乱七八糟的判断了，让大家能够看的更加清楚\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs js\" lang=\"js\"\u003E\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Ecomputed\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-params\"\u003Efn\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E value = \u003Cspan class=\"hljs-literal\"\u003Eundefined\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E runner = effect(fn, {\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 如果lazy不置为true的话，每次创建effect的时候都会立即执行一次\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 而我们要实现computed显然是不需要的\u003C\u002Fspan\u003E\n    lazy: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n  })\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 为什么要使用对象的形式，是因为我们最后需要得到computed的值\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 如果不用对象的 get 方法的话我们就需要手动再调用一次 computed() \u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E {\n    get value() {\n      \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E runner()\n    }\n  }\n}\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 使用起来是这样的\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E value = reactive({})\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E cValue = computed(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-params\"\u003E()\u003C\u002Fspan\u003E =\u003E\u003C\u002Fspan\u003E value.foo)\nvalue.foo = \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(cValue.value) \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 1\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch4 class=\"heading\" data-id=\"heading-3\"\u003E这也太简单了吧，那么重点来了，effect怎么实现的呢？\u003C\u002Fh4\u003E\n\u003Cp\u003E别着急，我们先捋一下逻辑\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E首先 如果 effect 回调内有已响应的对象被触发了 get 时，effect就应该被储存起来\u003C\u002Fli\u003E\n\u003Cli\u003E然后，我们需要一个储存effect的地方，在effect函数调用的时候就应该把effect放进这个储存空间，在vue中使用的是一个数组activeReactiveEffectStack = []\u003C\u002Fli\u003E\n\u003Cli\u003E再后，每个target被触发的时候，都可能有多个effect，所以每个target需要有一个对应的依赖收集器 deps，等到 set 时遍历 deps 执行 effect()\u003C\u002Fli\u003E\n\u003Cli\u003E然而，这个依赖收集器 deps 不能放在 target 本身上，这样会使数据看起来不是很简洁，还会存在多余无用的数据，所以我们需要一个 map 集合来储存 target 跟 deps 的关系， 在vue中这个储存集合叫 targetMap 。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch5 class=\"heading\" data-id=\"heading-4\"\u003E几个概念\u003C\u002Fh5\u003E\n\u003Col\u003E\n\u003Cli\u003Etrack 追踪器，在 get 时调用该函数，将所有 get 的 target 跟 key 以及 effect 建立起对应关系\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs js\" lang=\"js\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 比如 const react = reactive({a: { b: 2 })\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F react.a 时 target -\u003E {a: { b: 2 } key -\u003E a \u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F targetMap 储存了 target --\u003E Map --\u003E key --\u003E Set --\u003E dep --\u003E effect \u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 当调用 react.a.b.c.d.e 时 depsMap\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F {\"a\" =\u003E Set(1)} --\u003E Set --\u003E effect\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F {\"b\" =\u003E Set(1)}\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F {\"c\" =\u003E Set(1)}\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F {\"d\" =\u003E Set(1)}\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F {\"e\" =\u003E Set(1)}\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Etrack\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Etarget: any, key: string\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E effect = activeReactiveEffectStack[activeReactiveEffectStack.length - \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E];\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (effect) {\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E depsMap = targetMap.get(target);\n    \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (depsMap === \u003Cspan class=\"hljs-keyword\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E) {\n      targetMap.set(target, (depsMap = \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EMap\u003C\u002Fspan\u003E()));\n    }\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E dep = depsMap.get(key!);\n    \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (!dep) {\n      depsMap.set(key!, (dep = \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003ESet\u003C\u002Fspan\u003E()));\n    }\n    \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (!dep.has(effect)) {\n      dep.add(effect);\n      effect.deps.push(dep);\n    }\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Col start=\"2\"\u003E\n\u003Cli\u003Etrigger 触发器，这个就比较好理解了，拿到target key下的对应的所有 effect，然后遍历执行 effect()\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs js\" lang=\"js\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Etrigger\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Etarget: any, key?: string | symbol\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E depsMap: any = targetMap.get(target);\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E effects: any = \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003ESet\u003C\u002Fspan\u003E()\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (depsMap &#x26;&#x26; depsMap.get(key)) {\n    depsMap.get(key).forEach(\u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003Edep: any\u003C\u002Fspan\u003E) =\u003E\u003C\u002Fspan\u003E {\n      effects.add(dep)\n    });\n    effects.forEach(\u003Cspan class=\"hljs-function\"\u003E(\u003Cspan class=\"hljs-params\"\u003Ee: any\u003C\u002Fspan\u003E) =\u003E\u003C\u002Fspan\u003E e())\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Col start=\"3\"\u003E\n\u003Cli\u003Eeffect 函数实现\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs js\" lang=\"js\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 暴露的 effect 函数\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eeffect\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E\n  fn: Function,\n  options: any = EMPTY_OBJ\n\u003C\u002Fspan\u003E): \u003Cspan class=\"hljs-title\"\u003Eany\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E ((fn \u003Cspan class=\"hljs-keyword\"\u003Eas\u003C\u002Fspan\u003E any).isEffect) {\n    fn = (fn \u003Cspan class=\"hljs-keyword\"\u003Eas\u003C\u002Fspan\u003E any).raw\n  }\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E effect = createReactiveEffect(fn, options)\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 如果不是 lazy，则会立即执行一次\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (!options.lazy) {\n    effect()\n  }\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E effect\n}\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 创建 effect\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003EcreateReactiveEffect\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E\n  fn: Function,\n  options: any\n\u003C\u002Fspan\u003E): \u003Cspan class=\"hljs-title\"\u003Eany\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E effect = \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Eeffect\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E...args: any\u003C\u002Fspan\u003E): \u003Cspan class=\"hljs-title\"\u003Eany\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E run(effect \u003Cspan class=\"hljs-keyword\"\u003Eas\u003C\u002Fspan\u003E any, fn, args)\n  } \u003Cspan class=\"hljs-keyword\"\u003Eas\u003C\u002Fspan\u003E any\n  effect.isEffect = \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n  effect.active = \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n  effect.raw = fn\n  effect.scheduler = options.scheduler\n  effect.onTrack = options.onTrack\n  effect.onTrigger = options.onTrigger\n  effect.onStop = options.onStop\n  effect.computed = options.computed\n  effect.deps = []\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E effect\n}\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 执行函数，执行完之后会将储存的 effect 删除\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 这是函数 effect 的所有执行，所经历的完整的声明周期\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title\"\u003Erun\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003Eeffect: any, fn: Function, args: any[]\u003C\u002Fspan\u003E): \u003Cspan class=\"hljs-title\"\u003Eany\u003C\u002Fspan\u003E \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (!effect.active) {\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E fn(...args)\n  }\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (activeReactiveEffectStack.indexOf(effect) === \u003Cspan class=\"hljs-number\"\u003E-1\u003C\u002Fspan\u003E) {\n    \u003Cspan class=\"hljs-keyword\"\u003Etry\u003C\u002Fspan\u003E {\n      activeReactiveEffectStack.push(effect)\n      \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E fn(...args)\n    } \u003Cspan class=\"hljs-keyword\"\u003Efinally\u003C\u002Fspan\u003E {\n      activeReactiveEffectStack.pop()\n    }\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cblockquote\u003E\n\u003Cp\u003E一口气写了这么多，最后总结一下。在大家看源码的时候，如果发现有哪个地方无从下手的话，可以先从测试用例开始看。因为测试用例可以很清楚的知道这个函数想要达到什么效果，然后从效果上想，为什么这么做，如果我自己写的话应该怎么写，这样一点点就能揣摩出作者的意图了。再根据源码结合自己的想法你就能够学到很多。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n","6845076490250371085",3162,2,"全栈技匠",11385,"false",{},100,"1556564194374926","940837680722589","2780007432717400","1204720443866983","852876722177533","3227821828225517","column","\u002F"));</script><script src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/b53b63f.js" defer></script><script src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/3fe243d.js" defer></script><script src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/57b1c75.js" defer></script><script src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/3a01791.js" defer></script><script src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/43d21bf.js" defer></script><script src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/1da5cc6.js" defer></script><script src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/3e2b235.js" defer></script>
  </body>
</html>
